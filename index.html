<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Multi-View with Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f0f0f;
            color: #ffffff;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #272727;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .grid-dynamic {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
        }
        /* カスタムスクロールバー */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f0f0f;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- 左側: メインプレイヤーエリア -->
    <div class="flex-1 h-screen overflow-y-auto p-4 md:p-8">
        <header class="max-w-6xl mx-auto mb-10">
            <h1 class="text-3xl font-bold mb-6 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#FF0000" viewBox="0 0 256 256"><path d="M234.33,69.52a24,24,0,0,0-14.49-16.4C193.08,41,128,41,128,41s-65.08,0-91.84,12.12a24,24,0,0,0-14.49,16.4C18.39,84.09,16,128,16,128s2.39,43.91,5.67,58.48a24,24,0,0,0,14.49,16.41C62.92,215,128,215,128,215s65.08,0,91.84-12.12a24,24,0,0,0,14.49-16.41C237.61,171.91,240,128,240,128S237.61,84.09,234.33,69.52ZM160,128,104,160V96Z"></path></svg>
                YouTube 複窓プレイヤー
            </h1>
            
            <div class="bg-[#1e1e1e] p-6 rounded-2xl shadow-xl border border-white/10">
                <div class="flex flex-col md:flex-row gap-4">
                    <input 
                        type="text" 
                        id="videoUrl" 
                        placeholder="YouTubeのURLを入力" 
                        class="flex-1 bg-[#121212] border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600 transition-all text-white"
                    >
                    <button 
                        onclick="addVideoByUrl()" 
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition-colors flex items-center justify-center gap-2"
                    >
                        <span>追加</span>
                    </button>
                </div>
            </div>
        </header>

        <main id="videoGrid" class="grid-dynamic max-w-[1600px] mx-auto pb-20">
            <div id="emptyState" class="col-span-full py-20 text-center text-gray-500">
                <p class="text-xl font-medium">表示中の動画はありません</p>
                <p class="text-sm mt-2">URLを入力するか、右側の検索パネルから動画を追加してください</p>
            </div>
        </main>
    </div>

    <!-- 右側: 検索パネル -->
    <aside class="w-full md:w-80 lg:w-96 bg-[#0f0f0f] border-l border-white/10 flex flex-col h-screen shrink-0 shadow-2xl">
        <div class="p-4 border-b border-white/10 bg-[#121212]">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path></svg>
                動画を検索
            </h2>
            <div class="space-y-3">
                <div class="flex gap-2">
                    <input 
                        type="password" 
                        id="apiKey" 
                        placeholder="Google API Keyを入力" 
                        class="flex-1 bg-black/40 border border-white/10 rounded px-3 py-2 text-xs focus:ring-1 focus:ring-red-500 outline-none"
                    >
                    <button onclick="saveApiKey()" class="bg-white/10 hover:bg-white/20 text-xs px-3 rounded">保存</button>
                </div>
                <div class="relative">
                    <input 
                        type="text" 
                        id="searchQuery" 
                        placeholder="キーワードを入力..." 
                        class="w-full bg-[#1e1e1e] border border-white/10 rounded-lg px-4 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-red-600"
                        onkeypress="if(event.key === 'Enter') searchVideos()"
                    >
                    <button onclick="searchVideos()" class="absolute right-3 top-2.5 text-gray-400 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="searchResults" class="flex-1 overflow-y-auto p-4 space-y-4">
            <div class="text-center text-gray-500 py-10 text-sm">
                <p>YouTube Data APIを使用して<br>動画を検索できます</p>
                <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-400 hover:underline mt-2 block">APIキーを取得する</a>
            </div>
        </div>
    </aside>

    <script>
        const videoGrid = document.getElementById('videoGrid');
        const emptyState = document.getElementById('emptyState');
        const searchResults = document.getElementById('searchResults');
        let youtubeApiKey = localStorage.getItem('youtube_api_key') || '';

        // API Keyの初期セット
        if (youtubeApiKey) document.getElementById('apiKey').value = youtubeApiKey;

        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                youtubeApiKey = key;
                localStorage.setItem('youtube_api_key', key);
                alert('APIキーを保存しました。');
            }
        }

        // YouTube URLからID抽出
        function extractVideoId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length == 11) ? match[7] : false;
        }

        // プレイヤー追加の共通処理
        function createVideoElement(videoId) {
            emptyState.classList.add('hidden');
            
            const videoCard = document.createElement('div');
            videoCard.className = 'group relative bg-[#1e1e1e] rounded-2xl overflow-hidden border border-white/10 hover:border-white/30 transition-all shadow-lg animate-in fade-in zoom-in duration-300';
            
            videoCard.innerHTML = `
                <div class="video-container">
                    <iframe 
                        src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="p-3 flex justify-between items-center bg-[#1a1a1a]">
                    <span class="text-[10px] text-gray-500 font-mono tracking-tighter uppercase">ID: ${videoId}</span>
                    <button 
                        onclick="removeVideo(this)" 
                        class="text-gray-400 hover:text-red-500 transition-colors p-1"
                        title="削除"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm112,168a8,8,0,0,1-8,8H64a8,8,0,0,1-8-8V64H208Z"></path></svg>
                    </button>
                </div>
            `;
            videoGrid.appendChild(videoCard);
        }

        function addVideoByUrl() {
            const urlInput = document.getElementById('videoUrl');
            const videoId = extractVideoId(urlInput.value.trim());
            if (videoId) {
                createVideoElement(videoId);
                urlInput.value = '';
            } else {
                alert('有効なYouTube URLを入力してください。');
            }
        }

        function removeVideo(button) {
            const card = button.closest('.group');
            card.remove();
            if (videoGrid.querySelectorAll('.group').length === 0) {
                emptyState.classList.remove('hidden');
            }
        }

        // APIを使用した検索機能
        async function searchVideos() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) return;
            if (!youtubeApiKey) {
                alert('APIキーを入力して保存してください。Google Cloud Consoleで無料で作成できます。');
                return;
            }

            searchResults.innerHTML = '<div class="text-center text-gray-500 py-10">検索中...</div>';

            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query)}&type=video&key=${youtubeApiKey}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                searchResults.innerHTML = '';
                if (data.items.length === 0) {
                    searchResults.innerHTML = '<div class="text-center text-gray-500 py-10 text-sm">動画が見つかりませんでした</div>';
                    return;
                }

                data.items.forEach(item => {
                    const videoId = item.id.videoId;
                    const title = item.snippet.title;
                    const thumb = item.snippet.thumbnails.medium.url;
                    const channel = item.snippet.channelTitle;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'bg-[#1e1e1e] rounded-xl overflow-hidden cursor-pointer hover:ring-2 hover:ring-red-600 transition-all group';
                    itemEl.onclick = () => createVideoElement(videoId);
                    itemEl.innerHTML = `
                        <div class="relative">
                            <img src="${thumb}" class="w-full aspect-video object-cover" alt="${title}">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="white" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-88a8,8,0,0,1-8,8H136v24a8,8,0,0,1-16,0V136H96a8,8,0,0,1,0-16h24V96a8,8,0,0,1,16,0v24h24A8,8,0,0,1,168,128Z"></path></svg>
                            </div>
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium line-clamp-2 leading-tight mb-1">${title}</h3>
                            <p class="text-[11px] text-gray-400 truncate">${channel}</p>
                        </div>
                    `;
                    searchResults.appendChild(itemEl);
                });

            } catch (error) {
                searchResults.innerHTML = `<div class="text-center text-red-400 py-10 text-xs px-4">エラーが発生しました:<br>${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
