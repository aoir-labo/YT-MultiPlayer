<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Multi-View with Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f0f0f;
            color: #ffffff;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #272727;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .grid-dynamic {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f0f0f;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
        /* Sidebar transition */
        #sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="min-h-screen flex overflow-hidden">

    <!-- Main Content Area -->
    <div class="flex-1 h-screen overflow-y-auto relative">
        <!-- Floating Toggle Button -->
        <button 
            id="toggleSidebar"
            onclick="toggleSidebar()" 
            class="fixed top-6 right-6 z-50 bg-red-600 hover:bg-red-700 text-white p-3 rounded-full shadow-2xl transition-transform hidden hover:scale-110 active:scale-95"
        >
            <svg id="toggleIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
            </svg>
        </button>

        <!-- Initial Welcome / Center Search -->
        <div id="welcomeView" class="min-h-full flex flex-col items-center justify-center p-6 text-center">
            <div class="max-w-2xl w-full space-y-8 animate-in fade-in zoom-in duration-500">
                <div class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="#FF0000" viewBox="0 0 256 256"><path d="M234.33,69.52a24,24,0,0,0-14.49-16.4C193.08,41,128,41,128,41s-65.08,0-91.84,12.12a24,24,0,0,0-14.49,16.4C18.39,84.09,16,128,16,128s2.39,43.91,5.67,58.48a24,24,0,0,0,14.49,16.41C62.92,215,128,215,128,215s65.08,0,91.84-12.12a24,24,0,0,0,14.49-16.41C237.61,171.91,240,128,240,128S237.61,84.09,234.33,69.52ZM160,128,104,160V96Z"></path></svg>
                    <h1 class="text-4xl font-extrabold mt-4 tracking-tight">YouTube Multi-View</h1>
                    <p class="text-gray-400 mt-2 font-medium">URLを貼るか、キーワードで動画を探そう</p>
                </div>

                <div class="bg-[#1e1e1e] p-8 rounded-3xl shadow-2xl border border-white/10 space-y-6">
                    <div class="space-y-4">
                        <div class="relative flex items-center">
                            <input 
                                type="text" 
                                id="combinedInput" 
                                placeholder="URLを貼り付け、または動画を検索..." 
                                class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 pr-32 focus:outline-none focus:ring-2 focus:ring-red-600 transition-all text-lg"
                                onkeypress="if(event.key === 'Enter') handleSmartInput('combinedInput')"
                            >
                            <button 
                                onclick="handleSmartInput('combinedInput')" 
                                class="absolute right-3 bg-red-600 hover:bg-red-700 px-6 py-3 rounded-xl font-bold shadow-lg transition-all"
                            >
                                実行
                            </button>
                        </div>
                        <p class="text-[11px] text-gray-500 text-center uppercase tracking-widest">Type keyword to search or Paste URL to add</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Grid Area -->
        <main id="videoGrid" class="grid-dynamic max-w-[1800px] mx-auto p-4 md:p-8 pt-20 hidden">
            <!-- Videos injected here -->
        </main>
    </div>

    <!-- Right Sidebar -->
    <aside id="sidebar" class="fixed right-0 top-0 bottom-0 w-80 lg:w-96 bg-[#0f0f0f] border-l border-white/10 flex flex-col z-40 translate-x-full shadow-2xl">
        <!-- Sidebar Header & Search -->
        <div class="p-4 border-b border-white/10 bg-[#121212] flex flex-col gap-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path></svg>
                    検索・追加
                </h2>
                <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
                </button>
            </div>

            <div class="relative">
                <input 
                    type="text" 
                    id="sidebarInput" 
                    placeholder="キーワードまたはURL..." 
                    class="w-full bg-[#1e1e1e] border border-white/10 rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-red-600 text-sm shadow-inner"
                    onkeypress="if(event.key === 'Enter') handleSmartInput('sidebarInput')"
                >
                <button onclick="handleSmartInput('sidebarInput')" class="absolute right-3 top-3 text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path></svg>
                </button>
            </div>
        </div>

        <!-- Search Results List -->
        <div id="searchResults" class="flex-1 overflow-y-auto p-4 space-y-4 bg-black/20">
            <div class="text-center text-gray-500 py-10 text-xs italic">
                検索結果がここに表示されます
            </div>
        </div>

        <!-- API Settings Section (Moved to Bottom) -->
        <div class="border-t border-white/10 bg-[#121212]">
            <button 
                onclick="toggleApiSettings()" 
                class="w-full p-4 flex items-center justify-between text-xs text-gray-400 hover:text-white transition-colors"
            >
                <span class="flex items-center gap-2 uppercase tracking-widest font-bold">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm112.33-40.7-22.31-7.44a80,80,0,0,0-7.32-17.68l11-20.52a8,8,0,0,0-1.1-9.2L201.55,45.41a8,8,0,0,0-9.2-1.1l-20.52,11a80,80,0,0,0-17.68-7.32L146.7,25.67a8,8,0,0,0-7.66-5.67h-22.08a8,8,0,0,0-7.66,5.67l-7.44,22.31a80,80,0,0,0-17.68,7.32l-20.52-11a8,8,0,0,0-9.2,1.1L35.4,63.45a8,8,0,0,0-1.1,9.2l11,20.52a80,80,0,0,0-7.32,17.68l-22.31,7.44A8,8,0,0,0,10,126.04v22.08a8,8,0,0,0,5.67,7.66l22.31,7.44a80,80,0,0,0,7.32,17.68l-11,20.52a8,8,0,0,0,1.1,9.2L54.45,210.59a8,8,0,0,0,9.2,1.1l20.52-11a80,80,0,0,0,17.68,7.32l7.44,22.31a8,8,0,0,0,7.66,5.67h22.08a8,8,0,0,0,7.66-5.67l7.44-22.31a80,80,0,0,0,17.68-7.32l20.52,11a8,8,0,0,0,9.2-1.1l19.05-19.05a8,8,0,0,0,1.1-9.2l-11-20.52a80,80,0,0,0,7.32-17.68l22.31-7.44a8,8,0,0,0,5.67-7.66v-22.08A8,8,0,0,0,240.33,119.3ZM224.33,144l-21.36,7.12a8,8,0,0,0-5.32,6.1,64.32,64.32,0,0,1-10.37,25.06,8,8,0,0,0,0,8.14l10.54,19.68-12.33,12.33-19.68-10.54a8,8,0,0,0-8.14,0,64.32,64.32,0,0,1-25.06,10.37,8,8,0,0,0-6.1,5.32L128,223.33,120.88,202a8,8,0,0,0-6.1-5.32,64.32,64.32,0,0,1-25.06-10.37,8,8,0,0,0-8.14,0L61.9,196.85,49.57,184.52l10.54-19.68a8,8,0,0,0,0-8.14,64.32,64.32,0,0,1-10.37-25.06,8,8,0,0,0-5.32-6.1L23,138.33V126l21.36-7.12a8,8,0,0,0,5.32-6.1,64.32,64.32,0,0,1,10.37-25.06,8,8,0,0,0,0-8.14L49.51,59.9,61.84,47.57l19.68,10.54a8,8,0,0,0,8.14,0A64.32,64.32,0,0,1,114.72,47.74a8,8,0,0,0,6.1-5.32L128,21l7.12,21.36a8,8,0,0,0,6.1,5.32,64.32,64.32,0,0,1,25.06,10.37,8,8,0,0,0,8.14,0L194.1,47.48l12.33,12.33-10.54,19.68a8,8,0,0,0,0,8.14,64.32,64.32,0,0,1,10.37,25.06,8,8,0,0,0,5.32,6.1l21.36,7.12V144Z"></path></svg>
                    API 設定を表示
                </span>
                <svg id="apiSettingsChevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="transition-transform"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80a8,8,0,0,1,11.32-11.32L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg>
            </button>
            <div id="apiSettingsPanel" class="hidden p-4 pt-0 space-y-3 animate-in fade-in slide-in-from-bottom-2">
                <p class="text-[10px] text-gray-500 italic">検索機能を使用するには API キーが必要です。</p>
                <div class="flex gap-2">
                    <input 
                        type="password" 
                        id="apiKey" 
                        placeholder="Google API Key" 
                        class="flex-1 bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-xs focus:ring-1 focus:ring-red-500 outline-none"
                    >
                    <button onclick="saveApiKey()" class="bg-red-600 hover:bg-red-700 text-white text-[10px] px-4 rounded-lg font-bold transition-colors">保存</button>
                </div>
            </div>
        </div>
    </aside>

    <script>
        const videoGrid = document.getElementById('videoGrid');
        const welcomeView = document.getElementById('welcomeView');
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggleSidebar');
        const searchResults = document.getElementById('searchResults');
        const apiSettingsPanel = document.getElementById('apiSettingsPanel');
        const apiSettingsChevron = document.getElementById('apiSettingsChevron');
        
        let youtubeApiKey = localStorage.getItem('youtube_api_key') || '';
        let isSidebarOpen = false;

        if (youtubeApiKey) document.getElementById('apiKey').value = youtubeApiKey;

        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                youtubeApiKey = key;
                localStorage.setItem('youtube_api_key', key);
                alert('APIキーを保存しました。');
                toggleApiSettings();
            }
        }

        function toggleApiSettings() {
            const isHidden = apiSettingsPanel.classList.toggle('hidden');
            apiSettingsChevron.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
        }

        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            if (isSidebarOpen) {
                sidebar.classList.remove('translate-x-full');
            } else {
                sidebar.classList.add('translate-x-full');
            }
        }

        function extractVideoId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length == 11) ? match[7] : false;
        }

        async function handleSmartInput(inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            if (!value) return;

            const videoId = extractVideoId(value);

            if (videoId) {
                createVideoElement(videoId);
                input.value = '';
                if (isSidebarOpen) toggleSidebar();
            } else {
                if (!isSidebarOpen) {
                    toggleSidebar();
                    switchToGridView();
                }
                document.getElementById('sidebarInput').value = value;
                await searchVideos(value);
                input.value = '';
                // 検索時はフォーカスを外す（モバイルでキーボードを隠すため）
                input.blur();
            }
        }

        function switchToGridView() {
            welcomeView.classList.add('hidden');
            videoGrid.classList.remove('hidden');
            toggleBtn.classList.remove('hidden');
        }

        function createVideoElement(videoId) {
            switchToGridView();
            
            const videoCard = document.createElement('div');
            videoCard.className = 'group relative bg-[#1e1e1e] rounded-2xl overflow-hidden border border-white/10 hover:border-white/30 transition-all shadow-lg animate-in slide-in-from-bottom-4 duration-500';
            
            videoCard.innerHTML = `
                <div class="video-container">
                    <iframe 
                        src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="p-3 flex justify-between items-center bg-[#1a1a1a]">
                    <span class="text-[10px] text-gray-500 font-mono tracking-tighter uppercase">ID: ${videoId}</span>
                    <button 
                        onclick="removeVideo(this)" 
                        class="text-gray-400 hover:text-red-500 transition-colors p-1"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm112,168a8,8,0,0,1-8,8H64a8,8,0,0,1-8-8V64H208Z"></path></svg>
                    </button>
                </div>
            `;
            videoGrid.appendChild(videoCard);
        }

        function removeVideo(button) {
            button.closest('.group').remove();
            if (videoGrid.querySelectorAll('.group').length === 0) {
                welcomeView.classList.remove('hidden');
                videoGrid.classList.add('hidden');
                toggleBtn.classList.add('hidden');
                if (isSidebarOpen) toggleSidebar();
            }
        }

        async function searchVideos(query) {
            if (!query) return;
            if (!youtubeApiKey) {
                searchResults.innerHTML = `
                    <div class="text-center text-gray-500 py-10 px-4 space-y-4">
                        <p class="text-sm">APIキーが設定されていません</p>
                        <button onclick="toggleApiSettings()" class="text-blue-400 hover:underline text-xs">
                            設定パネルを開いてキーを入力してください
                        </button>
                    </div>
                `;
                return;
            }

            searchResults.innerHTML = '<div class="text-center text-gray-500 py-10">検索中...</div>';

            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(query)}&type=video&key=${youtubeApiKey}`);
                const data = await response.json();

                if (data.error) throw new Error(data.error.message);

                searchResults.innerHTML = '';
                if (data.items.length === 0) {
                    searchResults.innerHTML = '<div class="text-center text-gray-500 py-10 text-sm">見つかりませんでした</div>';
                    return;
                }

                data.items.forEach(item => {
                    const videoId = item.id.videoId;
                    const { title, thumbnails, channelTitle } = item.snippet;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'bg-white/5 rounded-xl overflow-hidden cursor-pointer hover:bg-white/10 transition-all group border border-white/5';
                    itemEl.onclick = () => {
                        createVideoElement(videoId);
                        if (window.innerWidth < 1024) toggleSidebar();
                    };
                    itemEl.innerHTML = `
                        <div class="relative aspect-video">
                            <img src="${thumbnails.medium.url}" class="w-full h-full object-cover" alt="">
                            <div class="absolute inset-0 bg-red-600/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                                <span class="bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded">追加する</span>
                            </div>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xs font-medium line-clamp-2 mb-1">${title}</h3>
                            <p class="text-[10px] text-gray-500 truncate">${channelTitle}</p>
                        </div>
                    `;
                    searchResults.appendChild(itemEl);
                });

            } catch (error) {
                searchResults.innerHTML = `<div class="text-center text-red-400 py-10 text-[10px] px-2 leading-relaxed">エラー: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
